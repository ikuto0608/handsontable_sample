<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="dist/handsontable.full.js"></script>
    <link rel="stylesheet" media="screen" href="dist/handsontable.full.css">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <link rel="stylesheet" media="screen" href="index.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.4/papaparse.js"></script>
  </head>
  <body>
    <div class="container">
      <h1>TEST</h1>
      <ul class="nav nav-tabs">
        <li class="active"><a id="tab1" data-toggle="tab" href="#tab1-content">Tab 1</a></li>
        <li><a id="tab2" data-toggle="tab" href="#tab2-content">Tab 2</a></li>
        <li><a id="tab3" data-toggle="tab" href="#tab3-content">Tab 3</a></li>
      </ul>

      <div class="tab-content">
        <div id="tab1-content" class="tab-pane fade in active">
        </div>
        <div id="tab2-content" class="tab-pane fade">
        </div>
        <div id="tab3-content" class="tab-pane fade">
        </div>
      </div>
    </div>

    <script type="text/javascript">
      var firstTable;
      var secondTable;

      function importFirstTable() {
        if (typeof firstTable !== 'undefined') {
          return;
        }

        $.ajax({
          url: 'http://localhost:8888/handsontable/us-500.csv',
          dataType: 'text',
        }).done(createTable);

        function createTable(data) {
          dataArray = Papa.parse(data).data;

/*
          data = data.replace(/(")/g,'');
          data = data.replace(/(\r\n|\r|\n)/g, '\n');
          var dataArray = data.split('\n');

          dataArray = dataArray.map(data => {
            return data.split(',');
          });
*/
          var headerArray = dataArray.splice(0, 1)[0];
          var container = document.getElementById('tab1-content');
          firstTable = new Handsontable(container, {
            data: dataArray,
            minSpareRows: 1,
            startRows: 1,
            startCols: 1,
            rowHeaders: true,
            colHeaders: headerArray,
            width: '100%',
            height: $(window).height() - $("#tab1-content").offset().top,
            columnSorting: true
          });
        }
      }

      function importSecondTable() {
        if (typeof secondTable !== 'undefined') {
          return;
        }

        $.ajax({
          url: 'http://localhost:8888/handsontable/us-99.csv',
          dataType: 'text',
        }).done(createTable);

        function createTable(data) {
          dataArray = Papa.parse(data).data;

/*
          data = data.replace(/(")/g,'');
          data = data.replace(/(\r\n|\r|\n)/g, '\n');
          var dataArray = data.split('\n');

          dataArray = dataArray.map(data => {
            return data.split(',');
          });
*/

          var headerArray = dataArray.splice(0, 1)[0];
          var container = document.getElementById('tab2-content');
          secondTable = new Handsontable(container, {
            data: dataArray,
            minSpareRows: 1,
            startRows: 1,
            startCols: 1,
            rowHeaders: true,
            colHeaders: headerArray,
            width: '100%',
            height: $(window).height() - $("#tab1-content").offset().top,
            columnSorting: true
          });
        }
      }

      $(document).ready(() => {
        importFirstTable();
        importSecondTable();
      });

      $('a#tab1').on('shown.bs.tab', (e) => {
        firstTable.render();
      });

      $('a#tab2').on('shown.bs.tab', (e) => {
        secondTable.render();
      });
    </script>
  </body>
</html>
